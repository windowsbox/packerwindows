{
  "variables": {
    "devtools": "false"
  },
  "builders": [
    {
      "type": "vsphere-iso",
      "CPUs": 2,
      "RAM": 4096,
      "iso_paths": [
        "[vsanDatastore] ISO/en-us_windows_server_2019_x64_dvd_f9475476.iso",
        "[vsanDatastore] ISO/windows.iso"
      ],
      "floppy_files": [
        "windows2019/Autounattend.xml",
        "firstboot.ps1",
        "winrm.ps1",
        "modules/WindowsBox.AutoLogon.psm1",
        "modules/WindowsBox.Compact.psm1",
        "modules/WindowsBox.DevMode.psm1",
        "modules/WindowsBox.Explorer.psm1",
        "modules/WindowsBox.Hibernation.psm1",
        "modules/WindowsBox.Network.psm1",
        "modules/WindowsBox.RDP.psm1",
        "modules/WindowsBox.UAC.psm1",
        "modules/WindowsBox.VMGuestTools.psm1",
        "modules/WindowsBox.WinRM.psm1"
      ],
      "network_adapters": [
        {
          "network_card": "vmxnet3"
        }
      ],
      "storage": [
        {
          "disk_size": 131072,
          "disk_thin_provisioned": true
        }
      ],
      "guest_os_type": "windows2019srv_64Guest",
      "username": "administrator@vsphere.local",
      "password": "{{user `vsphere_password`}}",
      "vcenter_server": "{{user `vsphere_host`}}",
      "host": "{{user `esxi_host`}}",
      "vm_name": "win2019",
      "communicator": "winrm",
      "insecure_connection": "true",
      "winrm_username": "Administrator",
      "winrm_password": "{{user `windows_password`}}",
      "winrm_timeout": "3h",
      "shutdown_command": "shutdown /s /t 10 /f /d p:4:1 /c \"Packer Shutdown\""
    }
  ],
  "provisioners": [
    {
      "type": "powershell",
      "scripts": ["provision.ps1"],
      "environment_vars": ["devtools={{user `devtools`}}"]
    },
    {
      "type": "windows-restart",
      "restart_timeout": "10m"
    }
  ]
}
